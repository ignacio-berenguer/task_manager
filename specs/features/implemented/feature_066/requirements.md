# Requirements Prompt for feature_066

I have a new feature request. Follow the "Architect First" protocol: create spec.md and plan.md before writing code. Notify me when the documents are ready.

Please create a './specs/features/feature_066/specs.md' and './specs/features/feature_066/plan.md' in order to do that.

## Feature Brief

Add chart visualization capabilities to both the MCP server agent and the web chatbot. Both agents should be able to display data in various chart types (bar, pie, line, etc.) and proactively suggest visualizing data obtained from query answers in chart form when it would be useful. The system prompt should include instructions on when and how to propose chart visualizations to the user.

## User Story

As an AI agent user (either via MCP client or the web chatbot), I want the agent to be able to render data it retrieves from the portfolio as visual charts (bar, pie, line, etc.), and to proactively suggest chart visualizations when the data it returns would benefit from a graphical representation.

## Key Requirements

### Requirement 1: Chart Generation Tool for the MCP Agent

The MCP server should expose a tool (or set of tools) that allows the agent to generate charts from portfolio data. Supported chart types should include at minimum: bar, pie, line, and possibly stacked bar / grouped bar. The chart output should be in a format the agent can present to the user (e.g., an image returned inline via the MCP protocol).

### Requirement 2: Chart Generation Tool for the Web Chatbot

The web chatbot (backend agent at `POST /api/v1/agent/chat`) should also have access to the same `generar_grafico` tool. Charts generated by the chatbot should be served as images via the backend API and displayed inline in the chat conversation. The frontend's existing Markdown renderer should handle image rendering.

### Requirement 3: Agent Suggestion Logic and System Prompt

The agent should have the capability to recognize when data returned from a query (e.g., aggregations, distributions, time series) would benefit from a chart visualization, and proactively suggest or offer to display the data as a chart. The system prompt (`backend/app/agent/system_prompt.py`) must include explicit instructions on:
- When to suggest a chart visualization (e.g., after aggregation results with 3+ groups)
- Which chart type to recommend based on the data nature
- How to phrase the suggestion to the user

### Requirement 4: Chart Type Selection

The agent should be able to select the most appropriate chart type based on the nature of the data:
- **Bar charts**: for categorical comparisons (e.g., initiatives per estado, budget per unidad)
- **Pie charts**: for proportional distributions (e.g., percentage of budget by framework)
- **Line charts**: for time-series or trend data (e.g., budget evolution across years)
- **Stacked/Grouped bar**: for multi-dimensional categorical data

### Requirement 5: Chart Customization

Charts should support basic customization:
- Title and subtitle
- Axis labels
- Legend
- Color palette consistent with the portfolio application theme
- Data labels on bars/slices where appropriate

### General Requirements

- The architecture should follow the file specs/architecture/architecture_backend.md and specs/architecture/architecture_frontend.md
- Update the README.md document after all the changes are done.
- Update the relevant architecture docs (specs/architecture/architecture_backend.md, specs/architecture/architecture_frontend.md) after all the changes are done.
- All the configuration needed should be stored in a .env file
- All the operations should be logged to a log file configured in .env file. The default debugging level will be INFO but it can be changed in the .env file
- The most important operations will be also logged to the console

## Constraints

- The existing application functionality from previous versions should be maintained as is, except for the changes in this feature.

## Final instructions

Analyze the current codebase and let me know when the docs are ready for review. Do not start making any modifications to the code until I review the documents and explicitly say so.
